# SPA веб-приложение
## Описание:
Созданы следующие модели:
1. Пользователь (приложение users):
* все поля от обычного пользователя, но авторизацию заменить на email;
* телефон;
* город;
* аватарка.
2. Платежи (приложение users):
* пользователь,
* дата оплаты,
* оплаченный курс или урок,
* сумма оплаты,
* способ оплаты: наличные или перевод на счет.
3. Курс (приложение lms):
* название,
* превью (картинка),
* описание,
* стоимость.
4. Урок (приложение lms):
* название,
* описание,
* превью (картинка),
* ссылка на видео,
* стоимость.
5. Подписка (приложение lms)
* пользователь,
* курс.

Урок и курс - это связанные между собой сущности.
Уроки складываются в курс, в одном курсе может быть много уроков.

При реализации CRUD для курса использованы Viewsets, а для урока - Generic-классы.

Для уроков предусмотрена дополнительная проверка на отсутствие в материалах ссылок на сторонние ресурсы, кроме youtube.com

Для модели курса добавлены поля вывода количества уроков и их имен.

Для вывода всех уроков и курсов реализована пагинация.

Добавлена возможность фильтрации списка платежей с возможностями:
* менять порядок сортировки по дате оплаты,
* фильтровать по курсу или уроку,
* фильтровать по способу оплаты.

Обязательным условием для выполнения любой операций, кроме входа и регистрации, является аутентификация.

Введены дополнительные ограничения прав пользователей.
1. Доступ ко списку курсов и уроков есть у всех пользователей. 
2. Обычные пользователи могут создать курс или урок,
но доступ к просмотру детальной информации, редактированию и удалению есть только у создателя материала.
3. У группы модераторов есть доступ к просмотру детальной информации о курсе и уроке, но нет прав для создания и удаления.

Организован вывод API-документации для проекта. Документация доступна по адресам:
* swagger/
* redoc/

Подключена возможность оплаты курсов через https://stripe.com/docs/api.

Добавлена асинхронная рассылка писем пользователям-подписчикам об обновлении материалов курса.

Добавлена фоновая задача по блокировке пользователей при неактивности на сайте более 1 месяца.
## Установка:
1. Подготовка окружения
* Установите Docker Desktop:
  * Скачайте с официального сайта: 
  * Установите для вашей ОС
  * Запустите Docker
2. Клонирование репозитория
    ```
    # Перейдите в директорию для проектов
    cd ~/Projects  # для Linux/MacOS
    # или
    cd C:\\Projects  # для Windows
    
    # Клонируйте репозиторий
    git clone https://github.com/Khailen13/project_5.git
    
    # Перейдите в директорию проекта
    cd project_5
    
    # Переключитесь на другую ветку
    git checkout feature/homework_34
    
    ```
3. Настройка окружения

   1. Создайте файл конфигурации .env путем копирования файла .env.sample.
   2. Укажите данные в файле .env:
        ```
        SECRET_KEY=ваш_уникальный_ключ
        
        DEBUG=False
        
        POSTGRES_DB=имя_базы_данных
        POSTGRES_USER=имя_пользователя
        POSTGRES_PASSWORD=пароль
        POSTGRES_HOST=хост
        POSTGRES_PORT=порт
        
        STRIPE_API_KEY=api_ключ_stripe
        
        CELERY_BROKER_URL=URL_адрес_брокера_celery
        CELERY_RESULT_BACKEND= URL_адрес_бэкенда_celery
        
        EMAIL_HOST_USER=логин_для_SMTP_сервера
        EMAIL_HOST_PASSWORD=пароль_для_SMTP_сервера
        ```
4. Сборка и запуск проекта

    ````
    docker-compose up -d
    ````
5. Проверка работы

   1. Проверьте статус контейнеров:
        ````
        docker-compose ps
        ````
   2. Просмотрите логи:
        ````
        docker-compose logs -f
        ````
7. Дополнительные команды

* Создание суперпользователя(email: admin@mail.ru; password: 123qwe - надо ли это выносить):
    ````
    docker-compose exec web python manage.py csu
    ````
* Перезапуск контейнеров:
    ````
    docker-compose restart
    ````

* Остановка контейнеров:
    ````
    docker-compose down
    ````
* Удаление всех данных:
    ````
    docker-compose down --volumes
    ````
## Использование:
Откройте в браузере:
* http://localhost:8000/ или http://localhost:8000/swagger/ (API-документация Swagger)
* http://localhost:8000/redoc/ (API-документация ReDoc)
* http://localhost:8000/admin/ (админ-панель)

## Документация:
Для получения дополнительной информации обратитесь к [документации](docs/README.md).

## Тестирование:
Отчет о тестировании находится в файле "index.html" в папке htmlcov.

## Лицензия:
Этот проект лицензирован по [лицензии MIT](LICENSE).